<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Be My Valentine?</title>

  <style>
    :root{
      --bg1: #ff9a9e;
      --bg2: #fad0c4;
      --brand: #b30059;
      --yes-bg: #ff3366;
      --no-bg:#555;
    }

    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; animation: none !important; }
    }

    body {
      font-family: 'Comic Sans MS', 'Comic Neue', cursive, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(to bottom, var(--bg1), var(--bg2));
      overflow: hidden;
      text-align: center;
      padding: 20px;
    }

    h1 { color: var(--brand); font-size: clamp(1.6rem, 3vw, 2.5rem); margin: 4px 0; }
    h2 { margin: 6px 0; font-weight: 400; color:#6b1030; }

    .buttons {
      margin-top: 22px;
      position: relative;
      width: min(720px, 95vw);
      height: 80px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 20px;
      pointer-events: none;
    }

    button {
      pointer-events: auto;
      padding: 12px 26px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 160ms ease, left 220ms ease, top 220ms ease;
      user-select: none;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    }

    #yes {
      background-color: var(--yes-bg);
      color: white;
    }

    #no {
      position: fixed;
      background-color: var(--no-bg);
      color: white;
      left: 50%;
      top: 50%;
      transform-origin: center;
    }

    .heart {
      position: absolute;
      color: red;
      font-size: 20px;
      animation: floatUp 6s linear infinite;
      pointer-events: none;
    }

    @keyframes floatUp {
      from { transform: translateY(100vh); opacity: 1; }
      to { transform: translateY(-10vh); opacity: 0; }
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      padding: 24px;
    }
    .card {
      background: linear-gradient(to bottom right,#fff6fb,#ffeef6);
      border-radius: 14px;
      padding: 30px;
      text-align:center;
      box-shadow: 0 12px 40px rgba(0,0,0,0.25);
      max-width: 720px;
      width: 100%;
    }

    @media (max-width:520px){
      .buttons { height: 110px; }
    }
  </style>
</head>

<body>
  <h1>Hey <span id="name">My Love</span> üíï</h1>
  <h1>Will you be my Valentine? üíò</h1>

  <div class="buttons" id="buttons">
    <button id="yes" aria-label="Yes, I will be your Valentine" role="button">Yes üíñ</button>
    <button id="no" aria-label="No, I will not" role="button">No üòú</button>
  </div>

  <!-- Music kept in DOM so playback can continue while overlay is present -->
  <audio id="music" loop preload="auto">
    <source src="./valentinemusic.mp3" type="audio/mpeg">
  </audio>

  <script>
    // CONFIG
    const DEFAULT_NAME = "Your Girl's Name";
    const MAX_HEARTS = 25;
    const MIN_SCALE = 0.6;
    const SCALE_STEP = 0.08;

    function queryParam(name) {
      try { const params = new URLSearchParams(location.search); return params.get(name); } catch (e) { return null; }
    }

    const herName = (queryParam('name') || DEFAULT_NAME);
    document.getElementById("name").innerText = herName;

    const yesBtn = document.getElementById("yes");
    const noBtn = document.getElementById("no");
    const music = document.getElementById("music");
    let noScale = 1;
    let heartCount = 0;

    // Move the No button to a random visible location, strictly clamped to viewport bounds.
    function moveNoToRandom() {
      const padding = 20;
      const btnW = noBtn.offsetWidth || 80;
      const btnH = noBtn.offsetHeight || 40;
      const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
      const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

      const maxLeft = Math.max(vw - btnW - padding, padding);
      const maxTop = Math.max(vh - btnH - padding, padding);

      const x = (maxLeft === padding) ? padding : Math.floor(Math.random() * (maxLeft - padding + 1)) + padding;
      const y = (maxTop === padding) ? padding : Math.floor(Math.random() * (maxTop - padding + 1)) + padding;

      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
    }

    function dodgeNo() {
      noScale = Math.max(MIN_SCALE, noScale - SCALE_STEP);
      noBtn.style.transform = `scale(${noScale})`;
      if (noScale <= 0.75) noBtn.innerText = "Just say YES üò≠";
      moveNoToRandom();
    }

    let lastDodge = 0;
    function maybeDodge() {
      const now = performance.now();
      if (now - lastDodge < 120) return;
      lastDodge = now;
      dodgeNo();
    }

    // Events
    noBtn.addEventListener('pointerenter', maybeDodge);
    noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); maybeDodge(); });
    noBtn.addEventListener('click', (e) => { maybeDodge(); });

    yesBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); sayYes(); }
    });
    noBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); maybeDodge(); }
    });

    // Hearts
    const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    function createHeart() {
      if (prefersReducedMotion) return;
      if (heartCount >= MAX_HEARTS) return;
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.innerText = "‚ù§Ô∏è";
      heart.style.left = Math.random() * 100 + "vw";
      heart.style.fontSize = (Math.random() * 26 + 12) + "px";
      heart.style.animationDuration = (Math.random() * 4 + 4) + "s";
      document.body.appendChild(heart);
      heartCount++;
      setTimeout(() => { heart.remove(); heartCount--; }, 9000);
    }
    const heartInterval = setInterval(createHeart, 350);

    // Yes click: play music + overlay
    function sayYes() {
      const playPromise = music.play();
      if (playPromise !== undefined) {
        playPromise.catch((err) => console.warn("Music playback prevented:", err));
      }
      clearInterval(heartInterval);

      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      overlay.setAttribute('role', 'dialog');
      overlay.setAttribute('aria-modal', 'true');
      overlay.innerHTML = `
        <div class="card">
          <h1 style="font-size:2.2rem">YAYYYYY üíïü•∞</h1>
          <h2>You just made me the happiest person ever üíò</h2>
          <h2>Happy Valentine‚Äôs Day ‚ù§Ô∏è</h2>
          <p style="margin-top:18px;font-size:0.95rem;color:#6b1030">Music should be playing ‚Äî allow playback if your browser blocked it.</p>
          <div style="margin-top:20px;"><button id="closeOverlay" style="padding:10px 18px;border-radius:8px;background:#b30059;color:#fff;border:none;cursor:pointer">Close</button></div>
        </div>
      `;
      document.body.appendChild(overlay);
      const closeBtn = document.getElementById('closeOverlay');
      closeBtn.focus();
      closeBtn.addEventListener('click', () => { overlay.remove(); });
    }
    yesBtn.addEventListener('click', sayYes);

    // initial NO position
    requestAnimationFrame(() => { moveNoToRandom(); });

    // Keep NO inside viewport after resize
    window.addEventListener('resize', () => {
      const padding = 12;
      const btnW = noBtn.offsetWidth || 80;
      const btnH = noBtn.offsetHeight || 40;
      const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
      const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
      const maxLeft = Math.max(vw - btnW - padding, padding);
      const maxTop = Math.max(vh - btnH - padding, padding);

      const rect = noBtn.getBoundingClientRect();
      let left = rect.left;
      let top = rect.top;

      let changed = false;
      if (left > maxLeft) { left = maxLeft; changed = true; }
      if (top > maxTop) { top = maxTop; changed = true; }
      if (left < padding) { left = padding; changed = true; }
      if (top < padding) { top = padding; changed = true; }
      if (changed) {
        noBtn.style.left = left + "px";
        noBtn.style.top = top + "px";
      }
    });
  </script>
</body>
</html>